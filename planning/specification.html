<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Provider Plugin - Complete Specification</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #a78bfa 0%, #818cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #94a3b8;
            margin-bottom: 40px;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #f8fafc;
            margin-top: 48px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #334155;
        }

        h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #e2e8f0;
            margin-top: 32px;
            margin-bottom: 12px;
        }

        h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #cbd5e1;
            margin-top: 24px;
            margin-bottom: 8px;
        }

        p {
            margin-bottom: 16px;
            color: #cbd5e1;
        }

        ul, ol {
            margin-bottom: 16px;
            padding-left: 24px;
        }

        li {
            margin-bottom: 8px;
            color: #cbd5e1;
        }

        code {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            background: #1e293b;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #a78bfa;
        }

        pre {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
            margin-bottom: 16px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        pre code {
            background: none;
            padding: 0;
            color: #e2e8f0;
        }

        .callout {
            background: #1e293b;
            border-left: 4px solid #a78bfa;
            padding: 16px 20px;
            margin: 24px 0;
            border-radius: 0 8px 8px 0;
        }

        .callout.warning {
            border-color: #f59e0b;
        }

        .callout.success {
            border-color: #22c55e;
        }

        .callout.info {
            border-color: #3b82f6;
        }

        .callout-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #f8fafc;
        }

        .table-wrapper {
            overflow-x: auto;
            margin-bottom: 24px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #334155;
        }

        th {
            background: #1e293b;
            font-weight: 600;
            color: #f8fafc;
        }

        tr:hover {
            background: #1e293b;
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .tag-required {
            background: #7c3aed;
            color: white;
        }

        .tag-optional {
            background: #334155;
            color: #94a3b8;
        }

        .tag-future {
            background: #1e293b;
            border: 1px solid #334155;
            color: #64748b;
        }

        .file-tree {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 16px;
            font-family: 'SF Mono', monospace;
            font-size: 0.85rem;
            margin-bottom: 24px;
        }

        .file-tree-item {
            padding: 4px 0;
        }

        .file-tree-item.folder {
            color: #a78bfa;
        }

        .file-tree-item.file {
            color: #94a3b8;
        }

        .toc {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 40px;
        }

        .toc-title {
            font-weight: 600;
            margin-bottom: 16px;
            color: #f8fafc;
        }

        .toc a {
            color: #94a3b8;
            text-decoration: none;
            display: block;
            padding: 4px 0;
        }

        .toc a:hover {
            color: #a78bfa;
        }

        .toc .indent {
            margin-left: 16px;
        }

        hr {
            border: none;
            border-top: 1px solid #334155;
            margin: 40px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Claude Provider Plugin</h1>
        <p class="subtitle">Complete Specification & Implementation Guide</p>

        <div class="toc">
            <div class="toc-title">Table of Contents</div>
            <a href="#overview">1. Overview</a>
            <a href="#problem" class="indent">1.1 Problem Statement</a>
            <a href="#solution" class="indent">1.2 Solution</a>
            <a href="#research">2. Research & Background</a>
            <a href="#providers" class="indent">2.1 Supported Providers</a>
            <a href="#env-vars" class="indent">2.2 Environment Variables</a>
            <a href="#plugin-system" class="indent">2.3 Claude Code Plugin System</a>
            <a href="#architecture">3. Plugin Architecture</a>
            <a href="#file-structure" class="indent">3.1 File Structure</a>
            <a href="#commands" class="indent">3.2 Slash Commands</a>
            <a href="#skills" class="indent">3.3 Skills</a>
            <a href="#hooks" class="indent">3.4 Hooks</a>
            <a href="#user-flows">4. User Flows</a>
            <a href="#flow-new-user" class="indent">4.1 New User (No AWS CLI)</a>
            <a href="#flow-existing" class="indent">4.2 User with Existing Profiles</a>
            <a href="#flow-fresh-sso" class="indent">4.3 Fresh SSO Configuration</a>
            <a href="#ui-spec">5. UI Specification</a>
            <a href="#screen-specs" class="indent">5.1 Screen-by-Screen</a>
            <a href="#design-rules" class="indent">5.2 Design Rules</a>
            <a href="#implementation">6. Implementation Notes</a>
            <a href="#aws-cli" class="indent">6.1 AWS CLI Integration</a>
            <a href="#config-files" class="indent">6.2 Configuration Files</a>
            <a href="#future">7. Future Roadmap</a>
        </div>

        <!-- SECTION 1: OVERVIEW -->
        <h2 id="overview">1. Overview</h2>

        <h3 id="problem">1.1 Problem Statement</h3>
        <p>Configuring Claude Code to use enterprise cloud providers (AWS Bedrock, Google Vertex AI, Azure Foundry) is unnecessarily complex:</p>
        <ul>
            <li>Documentation is fragmented across multiple sources</li>
            <li>Users must manually set environment variables</li>
            <li>AWS SSO authentication requires multiple steps and CLI knowledge</li>
            <li>No guidance on which models are available in which regions</li>
            <li>Credential refresh is manual and confusing</li>
            <li>Debugging configuration issues requires deep knowledge</li>
        </ul>

        <h3 id="solution">1.2 Solution</h3>
        <p>A Claude Code plugin that provides:</p>
        <ul>
            <li><strong>Guided setup wizard</strong> — Step-by-step configuration via slash commands</li>
            <li><strong>Automatic dependency management</strong> — Installs AWS CLI if missing (with user permission)</li>
            <li><strong>Profile detection</strong> — Discovers existing AWS SSO profiles from ~/.aws/config</li>
            <li><strong>Smart defaults</strong> — Recommends Bedrock regions, handles common configurations</li>
            <li><strong>Auto-refresh configuration</strong> — Sets up credential refresh so users don't get interrupted</li>
            <li><strong>Diagnostics</strong> — Troubleshoots issues and provides clear fix instructions</li>
        </ul>

        <div class="callout success">
            <div class="callout-title">Design Philosophy</div>
            <p>The user should never have to know about environment variables, config file locations, or AWS internals. The plugin handles all of that. They just answer simple questions and it works.</p>
        </div>

        <!-- SECTION 2: RESEARCH -->
        <h2 id="research">2. Research & Background</h2>

        <h3 id="providers">2.1 Supported Providers</h3>
        <p>Claude Code officially supports four providers:</p>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Provider</th>
                        <th>Environment Variable</th>
                        <th>Plugin Support</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Anthropic API</td>
                        <td>(default)</td>
                        <td><span class="tag tag-optional">N/A</span></td>
                        <td>Default, no plugin needed</td>
                    </tr>
                    <tr>
                        <td>AWS Bedrock</td>
                        <td><code>CLAUDE_CODE_USE_BEDROCK=1</code></td>
                        <td><span class="tag tag-required">Phase 1</span></td>
                        <td>Primary focus</td>
                    </tr>
                    <tr>
                        <td>Google Vertex AI</td>
                        <td><code>CLAUDE_CODE_USE_VERTEX=1</code></td>
                        <td><span class="tag tag-future">Phase 2</span></td>
                        <td>Future</td>
                    </tr>
                    <tr>
                        <td>Azure Foundry</td>
                        <td><code>CLAUDE_CODE_USE_FOUNDRY=1</code></td>
                        <td><span class="tag tag-future">Phase 3</span></td>
                        <td>Future</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h3 id="env-vars">2.2 Environment Variables (AWS Bedrock)</h3>
        <p>These are the variables Claude Code reads for Bedrock integration:</p>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Required</th>
                        <th>Description</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>CLAUDE_CODE_USE_BEDROCK</code></td>
                        <td>Yes</td>
                        <td>Enables Bedrock mode</td>
                        <td><code>1</code></td>
                    </tr>
                    <tr>
                        <td><code>AWS_PROFILE</code></td>
                        <td>Yes*</td>
                        <td>AWS CLI profile name</td>
                        <td><code>cricut-dev</code></td>
                    </tr>
                    <tr>
                        <td><code>AWS_REGION</code></td>
                        <td>Yes</td>
                        <td>Bedrock region</td>
                        <td><code>us-west-2</code></td>
                    </tr>
                    <tr>
                        <td><code>ANTHROPIC_MODEL</code></td>
                        <td>No</td>
                        <td>Override default model</td>
                        <td><code>anthropic.claude-sonnet...</code></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p><em>* Or use AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY, but SSO with profiles is preferred.</em></p>

        <h4>Claude Code Settings for Auto-Refresh</h4>
        <p>Claude Code supports automatic credential refresh via <code>~/.claude/settings.json</code>:</p>
        <pre><code>{
  "env": {
    "CLAUDE_CODE_USE_BEDROCK": "1",
    "AWS_PROFILE": "cricut-dev",
    "AWS_REGION": "us-west-2"
  },
  "awsAuthRefresh": "aws sso login --profile cricut-dev"
}</code></pre>
        <p>When credentials expire, Claude Code runs the <code>awsAuthRefresh</code> command automatically.</p>

        <h3 id="plugin-system">2.3 Claude Code Plugin System</h3>
        <p>Plugins can include:</p>
        <ul>
            <li><strong>Slash commands</strong> — Markdown files in <code>commands/</code> that become <code>/plugin-name:command</code></li>
            <li><strong>Skills</strong> — Knowledge files Claude auto-invokes based on context</li>
            <li><strong>Hooks</strong> — Event handlers (SessionStart, PreToolUse, etc.)</li>
            <li><strong>MCP Servers</strong> — External tool integrations</li>
        </ul>

        <div class="callout info">
            <div class="callout-title">Plugin Constraint</div>
            <p>Plugins cannot hot-reload environment variables into a running session. Configuration changes require restarting Claude Code. This is a fundamental constraint we design around, not against.</p>
        </div>

        <!-- SECTION 3: ARCHITECTURE -->
        <h2 id="architecture">3. Plugin Architecture</h2>

        <h3 id="file-structure">3.1 File Structure</h3>
        <div class="file-tree">
            <div class="file-tree-item folder">claude-provider/</div>
            <div class="file-tree-item folder" style="margin-left: 16px;">.claude-plugin/</div>
            <div class="file-tree-item file" style="margin-left: 32px;">plugin.json</div>
            <div class="file-tree-item folder" style="margin-left: 16px;">commands/</div>
            <div class="file-tree-item file" style="margin-left: 32px;">provider.md</div>
            <div class="file-tree-item file" style="margin-left: 32px;">provider-status.md</div>
            <div class="file-tree-item file" style="margin-left: 32px;">provider-diagnose.md</div>
            <div class="file-tree-item file" style="margin-left: 32px;">provider-switch.md</div>
            <div class="file-tree-item file" style="margin-left: 32px;">provider-refresh.md</div>
            <div class="file-tree-item folder" style="margin-left: 16px;">skills/</div>
            <div class="file-tree-item folder" style="margin-left: 32px;">aws-bedrock-setup/</div>
            <div class="file-tree-item file" style="margin-left: 48px;">SKILL.md</div>
            <div class="file-tree-item folder" style="margin-left: 16px;">hooks/</div>
            <div class="file-tree-item file" style="margin-left: 32px;">hooks.json</div>
            <div class="file-tree-item folder" style="margin-left: 16px;">scripts/</div>
            <div class="file-tree-item file" style="margin-left: 32px;">check-aws-cli.sh</div>
            <div class="file-tree-item file" style="margin-left: 32px;">parse-aws-profiles.sh</div>
            <div class="file-tree-item file" style="margin-left: 32px;">check-sso-session.sh</div>
            <div class="file-tree-item file" style="margin-left: 32px;">apply-config.sh</div>
        </div>

        <h3 id="commands">3.2 Slash Commands</h3>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Command</th>
                        <th>Purpose</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>/provider</code></td>
                        <td>Main entry point, guided setup wizard</td>
                        <td>Interactive, multi-step</td>
                    </tr>
                    <tr>
                        <td><code>/provider:status</code></td>
                        <td>Show current configuration</td>
                        <td>Quick view, no interaction</td>
                    </tr>
                    <tr>
                        <td><code>/provider:diagnose</code></td>
                        <td>Run diagnostics, identify issues</td>
                        <td>Checks CLI, auth, models</td>
                    </tr>
                    <tr>
                        <td><code>/provider:switch</code></td>
                        <td>Switch between configured providers</td>
                        <td>Only if multiple configured</td>
                    </tr>
                    <tr>
                        <td><code>/provider:refresh</code></td>
                        <td>Re-authenticate SSO session</td>
                        <td>Runs aws sso login</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h3 id="skills">3.3 Skills</h3>
        <p>The <code>aws-bedrock-setup</code> skill provides Claude with deep knowledge about:</p>
        <ul>
            <li>AWS SSO configuration steps</li>
            <li>Bedrock region availability</li>
            <li>Common error messages and their fixes</li>
            <li>IAM permission requirements</li>
            <li>Model naming conventions for Bedrock</li>
        </ul>

        <h3 id="hooks">3.4 Hooks (Optional)</h3>
        <p>For future enhancement, a SessionStart hook could warn users if their SSO session is expired:</p>
        <pre><code>{
  "SessionStart": [
    {
      "hooks": [{
        "type": "command",
        "command": "bash ${CLAUDE_PLUGIN_ROOT}/scripts/check-sso-session.sh"
      }]
    }
  ]
}</code></pre>

        <!-- SECTION 4: USER FLOWS -->
        <h2 id="user-flows">4. User Flows</h2>

        <h3 id="flow-new-user">4.1 New User (No AWS CLI)</h3>
        <ol>
            <li>User runs <code>/provider</code></li>
            <li>Plugin checks for AWS CLI → not found</li>
            <li>Prompt: "AWS CLI is required. Install it? [y/m/q]"</li>
            <li>If yes → run <code>brew install awscli</code></li>
            <li>Continue to SSO configuration flow</li>
        </ol>

        <h3 id="flow-existing">4.2 User with Existing AWS Profiles</h3>
        <ol>
            <li>User runs <code>/provider</code></li>
            <li>Plugin parses <code>~/.aws/config</code> for SSO profiles</li>
            <li>Shows list: "Select a profile to use with Bedrock:"</li>
            <li>User picks one</li>
            <li>Show Bedrock region selection</li>
            <li>Run <code>aws sso login --profile X</code> (opens browser)</li>
            <li>Apply configuration to <code>~/.claude/settings.json</code></li>
            <li>Show success message with restart instruction</li>
        </ol>

        <h3 id="flow-fresh-sso">4.3 Fresh SSO Configuration</h3>
        <ol>
            <li>User has no existing SSO profiles</li>
            <li>Prompt for SSO Start URL (e.g., https://company.awsapps.com/start)</li>
            <li>Prompt for SSO Region (default: us-east-1)</li>
            <li>Run SSO login → opens browser</li>
            <li>User selects account/role in AWS SSO portal (browser handles this)</li>
            <li>Prompt for profile name (default: claude-bedrock)</li>
            <li>Continue with Bedrock region selection</li>
            <li>Apply configuration</li>
        </ol>

        <div class="callout">
            <div class="callout-title">Key Insight</div>
            <p>The AWS SSO browser flow handles account and role selection. We don't need to ask users for account IDs or role names—AWS handles it in the browser. We only need: SSO URL, SSO region, and what to name the profile.</p>
        </div>

        <!-- SECTION 5: UI SPEC -->
        <h2 id="ui-spec">5. UI Specification</h2>

        <h3 id="screen-specs">5.1 Screen-by-Screen Specification</h3>

        <h4>Screen 1: Provider Selection</h4>
        <pre><code>❯ /provider

Claude Provider Setup
Configure Claude Code to use enterprise cloud providers

Select a provider:

  [1] AWS Bedrock
  [2] Google Vertex AI (coming soon)
  [3] Azure Foundry (coming soon)

  [s] View status
  [q] Cancel

Choice: _</code></pre>

        <h4>Screen 2a: Existing Profiles Found</h4>
        <pre><code>❯ /provider
Selected: AWS Bedrock

Checking AWS configuration...

✓ AWS CLI installed (v2.15.0)
✓ Found existing SSO profiles

Select a profile to use with Bedrock:

  [1] cricut-dev - us-east-1
  [2] cricut-prod - us-east-1
  [3] personal - us-west-2

  [n] Configure a new profile
  [q] Cancel

Choice: _</code></pre>

        <h4>Screen 2b: No Profiles Found</h4>
        <pre><code>❯ /provider
Selected: AWS Bedrock

Checking AWS configuration...

✓ AWS CLI installed (v2.15.0)
! No SSO profiles found

Let's set up AWS SSO.

Enter your SSO start URL:
  This is usually https://your-company.awsapps.com/start
  Ask your IT team if you're not sure.

SSO URL: _</code></pre>

        <h4>Screen 2c: SSO Region</h4>
        <pre><code>❯ /provider
SSO URL: https://cricut.awsapps.com/start

SSO Region:
  Where your company's SSO is hosted (usually us-east-1)

Region [us-east-1]: _</code></pre>

        <h4>Screen 2d: Browser Authentication</h4>
        <pre><code>❯ /provider
Configuring new SSO profile...

Opening browser for AWS SSO login...

If the browser doesn't open, visit:
  https://device.sso.us-east-1.amazonaws.com/?user_code=BMHT-GRXP

Select your account and role in the browser, then return here.

Waiting for authentication...</code></pre>

        <h4>Screen 2e: Profile Name</h4>
        <pre><code>❯ /provider

✓ Authentication successful
  Account: 847293650183 (Development)

Name for this profile:

Profile name [claude-bedrock]: _</code></pre>

        <h4>Screen 3: Bedrock Region Selection</h4>
        <pre><code>❯ /provider
Profile: cricut-dev

Select Bedrock region

  [1] us-east-1 (N. Virginia)
  [2] us-west-2 (Oregon) ← recommended
  [3] eu-west-1 (Ireland)
  [4] eu-central-1 (Frankfurt)
  [5] ap-northeast-1 (Tokyo)
  [6] ap-southeast-2 (Sydney)

Region [2]: _</code></pre>

        <h4>Screen 4: Authenticating (Existing Profile)</h4>
        <pre><code>❯ /provider
Profile: cricut-dev • Region: us-west-2

Authenticating...

Running: aws sso login --profile cricut-dev

Opening browser for SSO login...

If the browser doesn't open, visit:
  https://device.sso.us-east-1.amazonaws.com/?user_code=BMHT-GRXP

Waiting for authentication...</code></pre>

        <h4>Screen 5: Applying Configuration</h4>
        <pre><code>❯ /provider
Profile: cricut-dev • Region: us-west-2

✓ Authentication successful

Applying configuration...

✓ Enabled Bedrock mode
✓ Set profile to cricut-dev
✓ Set region to us-west-2
✓ Configured auto-refresh

Saved to ~/.claude/settings.json</code></pre>

        <h4>Screen 6: Success</h4>
        <pre><code>────────────────────────────────────────────
  ✓ AWS Bedrock configured
────────────────────────────────────────────

  Provider:     AWS Bedrock
  Profile:      cricut-dev
  Region:       us-west-2
  Auto-refresh: on

Restart required
Exit Claude Code and run claude again to use Bedrock.

Run /provider:status to check configuration anytime.</code></pre>

        <h4>Screen 7: Status View (/provider:status)</h4>
        <pre><code>❯ /provider:status

Claude Provider Status
────────────────────────────────────────────

Active Provider
  Provider:     AWS Bedrock ● active
  Profile:      cricut-dev
  Region:       us-west-2
  Auth:         ✓ valid (6h 23m remaining)
  Auto-refresh: on

Configured Providers
  ● AWS Bedrock - cricut-dev
  ○ Google Vertex AI - not configured
  ○ Azure Foundry - not configured

Commands: /provider:diagnose • /provider:switch • /provider</code></pre>

        <h4>Screen 8: Diagnostics Success (/provider:diagnose)</h4>
        <pre><code>❯ /provider:diagnose

Running diagnostics...

System
  ✓ AWS CLI installed (v2.15.0)
  ✓ Profile exists (cricut-dev)

Authentication
  ✓ SSO session valid
  ✓ Credentials not expired (6h 23m remaining)
  ✓ Auto-refresh configured

Bedrock Access
  ✓ Region us-west-2 supports Bedrock
  ✓ Claude Sonnet available
  ✓ Claude Opus available
  ✓ Claude Haiku available

Claude Code
  ✓ Bedrock mode enabled
  ✓ Profile configured
  ✓ Region configured

✓ All checks passed</code></pre>

        <h4>Screen 9: Diagnostics Error</h4>
        <pre><code>❯ /provider:diagnose

Running diagnostics...

System
  ✓ AWS CLI installed (v2.15.0)
  ✓ Profile exists (cricut-dev)

Authentication
  ✗ SSO session expired

Issue found
Your SSO session has expired.

To fix:
  aws sso login --profile cricut-dev

Or run /provider:refresh to re-authenticate.</code></pre>

        <h4>Screen 10: No AWS CLI</h4>
        <pre><code>❯ /provider
Selected: AWS Bedrock

Checking AWS configuration...

✗ AWS CLI not installed

AWS CLI is required. Install it?

  [y] Yes, install with Homebrew
  [m] I'll install it manually
  [q] Cancel

Choice [y]: _</code></pre>

        <h4>Screen 11: Installing AWS CLI</h4>
        <pre><code>❯ /provider
Installing AWS CLI...

Running: brew install awscli

==> Downloading awscli-2.15.0...
==> Installing dependencies: python@3.11
==> Installing awscli

✓ AWS CLI installed (v2.15.0)

Continuing...</code></pre>

        <h4>Screen 12: Switch Provider (/provider:switch)</h4>
        <pre><code>❯ /provider:switch

Switch provider

  [1] ● AWS Bedrock - cricut-dev (us-west-2) [current]
  [2] ○ Google Vertex AI - my-project (us-central1)

  [q] Cancel

Choice: _

Switching requires a Claude Code restart.</code></pre>

        <h3 id="design-rules">5.2 Design Rules</h3>
        <ul>
            <li><strong>No decorative emojis</strong> — Only use ✓ ✗ ● ○ for status indicators</li>
            <li><strong>Defaults in brackets</strong> — e.g., <code>Region [2]: _</code> means press Enter for option 2</li>
            <li><strong>Numbered choices</strong> — [1], [2], [3] for selection, [y/n/q] for yes/no/cancel</li>
            <li><strong>Dim for unavailable</strong> — Coming soon items shown in dim/gray</li>
            <li><strong>No env var exposure</strong> — Don't show CLAUDE_CODE_USE_BEDROCK=1, just say "Bedrock mode enabled"</li>
            <li><strong>Friendly language</strong> — "Auth: valid" not "SSO session status: ACTIVE"</li>
            <li><strong>Consistent structure</strong> — Title, context line, content, choices, prompt</li>
        </ul>

        <!-- SECTION 6: IMPLEMENTATION -->
        <h2 id="implementation">6. Implementation Notes</h2>

        <h3 id="aws-cli">6.1 AWS CLI Integration</h3>

        <h4>Check if AWS CLI is installed</h4>
        <pre><code>which aws && aws --version</code></pre>

        <h4>Parse existing SSO profiles from ~/.aws/config</h4>
        <pre><code># Look for sections like [profile name] that contain sso_start_url
grep -E "^\[profile |sso_start_url|sso_region" ~/.aws/config</code></pre>
        <p>Example ~/.aws/config with SSO profile:</p>
        <pre><code>[profile cricut-dev]
sso_start_url = https://cricut.awsapps.com/start
sso_region = us-east-1
sso_account_id = 847293650183
sso_role_name = PowerUserAccess
region = us-west-2
output = json</code></pre>

        <h4>Check if SSO session is valid</h4>
        <pre><code>aws sts get-caller-identity --profile PROFILE_NAME 2>&1</code></pre>
        <p>If this returns account info, session is valid. If it errors with "Token has expired", session needs refresh.</p>

        <h4>Get session expiration time</h4>
        <pre><code># SSO cache files are in ~/.aws/sso/cache/
# Parse the JSON to find expiresAt for the relevant session
cat ~/.aws/sso/cache/*.json | jq -r '.expiresAt'</code></pre>

        <h4>Run SSO login</h4>
        <pre><code>aws sso login --profile PROFILE_NAME</code></pre>
        <p>This opens the browser. The CLI waits for completion.</p>

        <h4>Configure a new SSO profile</h4>
        <pre><code>aws configure sso --profile PROFILE_NAME</code></pre>
        <p>This is interactive and handles the full setup including browser auth.</p>

        <h3 id="config-files">6.2 Configuration Files</h3>

        <h4>Claude Code settings location</h4>
        <pre><code>~/.claude/settings.json</code></pre>

        <h4>Example configuration to write</h4>
        <pre><code>{
  "env": {
    "CLAUDE_CODE_USE_BEDROCK": "1",
    "AWS_PROFILE": "cricut-dev",
    "AWS_REGION": "us-west-2"
  },
  "awsAuthRefresh": "aws sso login --profile cricut-dev"
}</code></pre>

        <h4>Merging configuration</h4>
        <p>The plugin should:</p>
        <ol>
            <li>Read existing settings.json (if exists)</li>
            <li>Merge in the new env vars and awsAuthRefresh</li>
            <li>Write back, preserving other settings (MCP servers, hooks, etc.)</li>
        </ol>

        <div class="callout warning">
            <div class="callout-title">Important</div>
            <p>Never overwrite the entire settings.json. Users may have other settings that must be preserved. Always read, merge, then write.</p>
        </div>

        <h4>Bedrock regions with Claude availability (as of January 2025)</h4>
        <ul>
            <li>us-east-1 (N. Virginia)</li>
            <li>us-west-2 (Oregon) — recommended, best availability</li>
            <li>eu-west-1 (Ireland)</li>
            <li>eu-central-1 (Frankfurt)</li>
            <li>ap-northeast-1 (Tokyo)</li>
            <li>ap-southeast-2 (Sydney)</li>
        </ul>

        <!-- SECTION 7: FUTURE -->
        <h2 id="future">7. Future Roadmap</h2>

        <h4>Phase 1: AWS Bedrock (Current Scope)</h4>
        <ul>
            <li>Full setup wizard</li>
            <li>Profile detection and selection</li>
            <li>SSO authentication flow</li>
            <li>Auto-refresh configuration</li>
            <li>Status and diagnostics</li>
        </ul>

        <h4>Phase 2: Google Vertex AI</h4>
        <ul>
            <li>gcloud CLI detection and installation</li>
            <li>Project selection</li>
            <li>Application default credentials setup</li>
            <li>Region configuration</li>
        </ul>

        <h4>Phase 3: Azure Foundry</h4>
        <ul>
            <li>Azure CLI integration</li>
            <li>Resource configuration</li>
            <li>Authentication flow</li>
        </ul>

        <h4>Phase 4: Multi-provider Support</h4>
        <ul>
            <li><code>/provider:switch</code> between configured providers</li>
            <li>Profile-based provider selection</li>
            <li>Quick toggle without re-authentication</li>
        </ul>

        <hr>

        <h2>Appendix A: Plugin Manifest</h2>
        <pre><code>{
  "name": "claude-provider",
  "description": "Configure Claude Code to use enterprise cloud providers (AWS Bedrock, Google Vertex AI, Azure Foundry)",
  "version": "0.1.0",
  "author": {
    "name": "Your Name"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/yourname/claude-provider"
  },
  "license": "MIT",
  "keywords": [
    "aws",
    "bedrock",
    "vertex",
    "azure",
    "enterprise",
    "provider"
  ]
}</code></pre>

        <hr>

        <h2>Appendix B: Reference Links</h2>
        <ul>
            <li><a href="https://code.claude.com/docs/en/amazon-bedrock" style="color: #a78bfa;">Claude Code on Amazon Bedrock</a> — Official Anthropic documentation</li>
            <li><a href="https://code.claude.com/docs/en/google-vertex-ai" style="color: #a78bfa;">Claude Code on Google Vertex AI</a> — Official Anthropic documentation</li>
            <li><a href="https://code.claude.com/docs/en/plugins" style="color: #a78bfa;">Create Claude Code Plugins</a> — Plugin development guide</li>
            <li><a href="https://github.com/anthropics/claude-code/tree/main/plugins" style="color: #a78bfa;">Example Plugins</a> — Official plugin examples</li>
            <li><a href="https://github.com/andisearch/claude-switcher" style="color: #a78bfa;">claude-switcher</a> — Similar project (wrapper approach, not plugin)</li>
        </ul>

        <hr>
        <p style="text-align: center; color: #64748b; margin-top: 40px;">
            Document generated from design session • January 2025<br>
            Reference prototype: prototype-cli-v2.html
        </p>
    </div>
</body>
</html>
